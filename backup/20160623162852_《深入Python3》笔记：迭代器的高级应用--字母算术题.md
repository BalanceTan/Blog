Title: 《深入Python3》笔记：迭代器的高级应用--字母算术题
Date: 2016-06-23 16:28:52
Category: 技术
Tags: 笔记, Python
Slug: 《深入Python3》笔记：迭代器的高级应用--字母算术题
Author: Lemon Tree

### **前提**

> HAWAII + IDAHO + IOWA + OHIO == STATES

每个字母对应一个数字，求解使等式成立时各个字母所代表的数字。

### **解法**

```python
import re
import itertools

def solve(puzzle):
    # re.findall返回puzzle中所有单词的列表
    words = re.findall('[A-Z]+', puzzle.upper())
    # 利用集和获取单词中不同的字母
    unique_characters = set(''.join(words))
    # 利用断言判断字母的个数，如果超过10个则触发异常(因为数字是0～9只有10个)
    assert len(unique_characters) <= 10, 'Too many letters'
    # 利用列表解析返回一个包含这些单词中不同的首字母的集和
    first_letters = {word[0] for word in words}
    # 获取不同的首字母的个数
    n = len(first_letters)
    # 对字母进行排序，将单词首字母放在字符串的前面
    sorted_characters = ''.join(first_letters) + \
        ''.join(unique_characters - first_letters)
    # 获取字母的ASCII值，并以元组的形式返回给characters
    characters = tuple(ord(c) for c in sorted_characters)
    # 获取数字的ASCII值，并以元组的形式返回给digits
    digits = tuple(ord(c) for c in '0123456789')
    zero = digits[0]
    # 对[0-9]进行排列，排列中数字的长度为len(characters)
    for guess in itertools.permutations(digits, len(characters)):
        # 因为数值的第一个数字不可能是0,所以要排除掉这种情况
        if zero not in guess[:n]:
            # zip制造一个一一对应的元组，然后通过dict显示转换为字典，字典的键为字母，值为数字
            # 通过translate将puzzle中相应的字母转换为数字，这样字母等式就全部变成了数字等式
            equation = puzzle.translate(dict(zip(characters, guess)))
            # 如果数字等式确实成立，则返回这个数字等式(字符串)
            # eval原来判断数字等式是否成立，eval的参数可以是任何python表达式并且返回任何数据类型
            if eval(equation):
                return equation

if __name__ == '__main__':
    import sys
    # sys.argv表示命令行参数，其中argv[0]表示当前的python文件名
    # 例如：python3 alphametics.py "HAWAII + IDAHO + IOWA + OHIO == STATES"
    # 其中sys.argv[0]是"alphametics.py"，sys.argv[1]是"HAWAII + IDAHO + IOWA + OHIO == STATES"
    for puzzle in sys.argv[1:]:
        print(puzzle)
        # 根据函数solve来看，solution是等式成立时的数字字符串
        solution = solve(puzzle)
        if solution:
            print(solution)
```

### **输出**

```shell
$ python3 alphametics.py "HAWAII + IDAHO + IOWA + OHIO == STATES"
HAWAII + IDAHO + IOWA + OHIO = STATES
510199 + 98153 + 9301 + 3593 == 621246
$ python3 alphametics.py "I + LOVE + YOU == DORA"
I + LOVE + YOU == DORA
1 + 2784 + 975 == 3760
$ python3 alphametics.py "SEND + MORE == MONEY"
SEND + MORE == MONEY
9567 + 1085 == 10652
```

\- 完 -
